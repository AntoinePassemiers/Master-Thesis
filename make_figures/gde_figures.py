
GDFUZZ3D_TM = [0.39, 0.39, 0.56, 0.36, 0.36, 0.27, 0.35, 0.35, 0.78, 0.51, 0.25, 0.24, 0.30, 0.62, 0.46, 0.63, 0.47, 0.47, 0.58, 0.61, 0.76, 0.56, 0.53, 0.49, 0.50, 0.57, 0.59, 0.76, 0.24, 0.51, 0.30, 0.56, 0.29, 0.29, 0.38, 0.59, 0.68, 0.25, 0.67, 0.52, 0.30, 0.36, 0.42, 0.33, 0.71, 0.61, 0.55, 0.45, 0.52, 0.42, 0.54, 0.22, 0.75, 0.62, 0.64, 0.27, 0.61, 0.72, 0.56, 0.38, 0.72, 0.50, 0.31, 0.62, 0.24, 0.32, 0.47, 0.47, 0.39, 0.49, 0.33, 0.71, 0.59, 0.72, 0.63, 0.32, 0.72, 0.33, 0.61, 0.39, 0.70, 0.63, 0.24, 0.58, 0.52, 0.55, 0.77, 0.40, 0.54, 0.56, 0.71, 0.36, 0.21, 0.19, 0.58, 0.58, 0.67, 0.54, 0.46, 0.32, 0.43, 0.36, 0.32, 0.42, 0.42, 0.42, 0.30, 0.23, 0.63, 0.51, 0.48, 0.63, 0.36, 0.63, 0.33, 0.40, 0.68, 0.37, 0.48, 0.53, 0.70, 0.37, 0.38, 0.72, 0.28, 0.66, 0.63, 0.73, 0.33, 0.67, 0.59, 0.42, 0.62, 0.68, 0.35, 0.27, 0.65, 0.55, 0.69, 0.27, 0.26, 0.40, 0.33, 0.28, 0.45, 0.57, 0.68, 0.69, 0.27, 0.69]
GDFUZZ3D_RMSD = [9.6, 9.7, 4.9, 5.4, 9.3, 10.7, 14.5, 11.4, 3.9, 6.3, 9.3, 15.1, 12.2, 4.2, 3.8, 6.3, 6.9, 6.6, 3.3, 3.3, 3.7, 8.9, 6.8, 4.2, 4.3, 6.8, 4.8, 4.5, 14.3, 6.1, 13.0, 4.6, 14.7, 12.6, 6.7, 4.8, 5.3, 13.1, 5.2, 8.6, 16.8, 8.1, 10.3, 8.0, 4.9, 6.3, 8.1, 13.4, 4.3, 7.9, 8.0, 15.3, 3.4, 3.7, 4.9, 15.8, 6.3, 5.2, 4.2, 9.0, 5.9, 7.8, 16.6, 5.5, 16.3, 12.9, 13.5, 10.8, 9.2, 8.4, 8.6, 3.4, 3.9, 4.9, 5.4, 10.6, 3.1, 14.6, 11.8, 12.0, 5.6, 7.2, 11.6, 2.9, 6.1, 7.5, 3.3, 8.3, 6.2, 8.1, 4.8, 11.2, 14.8, 15.4, 6.8, 3.6, 2.9, 8.4, 8.2, 11.5, 6.1, 5.3, 9.5, 8.6, 11.4, 12.5, 10.3, 12.1, 11.2, 8.1, 7.1, 3.9, 11.3, 5.5, 11.6, 13.1, 4.0, 10.8, 5.6, 8.7, 4.6, 8.8, 9.7, 2.6, 11.1, 3.5, 14.7, 3.9, 6.2, 5.3, 4.4, 7.6, 4.4, 5.7, 10.7, 12.1, 4.3, 7.1, 5.0, 15.2, 15.7, 8.3, 10.3, 12.1, 8.8, 12.3, 5.9, 4.3, 12.2, 4.3]
FTCOMAR_TM = [0.82, 0.36, 0.20, 0.24, 0.29, 0.18, 0.29, 0.18, 0.49, 0.24, 0.29, 0.18, 0.24, 0.32, 0.34, 0.28, 0.23, 0.21, 0.29, 0.23, 0.67, 0.42, 0.48, 0.42, 0.35, 0.39, 0.49, 0.60, 0.24, 0.48, 0.20, 0.27, 0.24, 0.21, 0.20, 0.25, 0.53, 0.24, 0.26, 0.26, 0.24, 0.24, 0.39, 0.27, 0.26, 0.30, 0.26, 0.25, 0.25, 0.25, 0.33, 0.26, 0.49, 0.21, 0.51, 0.25, 0.26, 0.31, 0.50, 0.19, 0.56, 0.29, 0.28, 0.26, 0.20, 0.19, 0.20, 0.38, 0.25, 0.24, 0.26, 0.40, 0.41, 0.59, 0.28, 0.28, 0.57, 0.25, 0.46, 0.32, 0.53, 0.48, 0.22, 0.21, 0.25, 0.22, 0.28, 0.29, 0.21, 0.50, 0.28, 0.26, 0.23, 0.17, 0.23, 0.39, 0.29, 0.26, 0.37, 0.20, 0.29, 0.23, 0.21, 0.42, 0.26, 0.27, 0.17, 0.25, 0.51, 0.44, 0.24, 0.22, 0.32, 0.44, 0.19, 0.29, 0.27, 0.23, 0.26, 0.27, 0.27, 0.25, 0.33, 0.63, 0.20, 0.24, 0.58, 0.54, 0.23, 0.29, 0.40, 0.37, 0.48, 0.29, 0.28, 0.41, 0.57, 0.28, 0.29, 0.19, 0.21, 0.38, 0.20, 0.39, 0.22, 0.47, 0.59, 0.29, 0.28, 0.57]
FTCOMAR_RMSD = [2.3, 10.7, 15.4, 9.1, 9.5, 12.9, 14.5, 22.4, 9.0, 11.8, 9.1, 17.1, 19.8, 10.3, 4.8, 16.6, 13.0, 23.9, 7.1, 10.6, 4.8, 9.5, 7.4, 4.2, 5.9, 20.1, 5.9, 5.4, 13.8, 7.4, 17.4, 14.1, 15.5, 21.4, 12.0, 12.6, 8.5, 15.2, 15.5, 14.8, 19.1, 11.0, 14.5, 8.9, 11.5, 15.4, 16.2, 18.3, 13.4, 14.0, 19.3, 16.8, 10.1, 9.6, 6.3, 16.8, 16.0, 14.7, 6.3, 14.9, 7.8, 13.4, 31.7, 15.2, 19.4, 17.2, 22.8, 11.9, 21.7, 15.0, 10.9, 7.2, 6.4, 5.5, 14.9, 13.0, 4.5, 17.3, 10.5, 13.0, 6.9, 12.5, 13.0, 10.6, 10.9, 13.8, 14.4, 9.8, 26.8, 12.3, 15.5, 14.7, 13.7, 20.7, 15.6, 7.4, 7.0, 14.9, 10.3, 14.8, 9.5, 10.5, 12.8, 8.7, 14.6, 21.2, 18.3, 11.1, 12.2, 9.1, 13.3, 11.5, 12.8, 7.8, 17.7, 16.5, 12.2, 13.6, 11.8, 16.2, 15.0, 10.1, 11.0, 3.1, 13.3, 11.7, 14.4, 6.1, 9.6, 13.4, 6.6, 7.9, 7.5, 14.7, 12.1, 5.9, 5.0, 15.2, 14.2, 21.4, 28.0, 8.0, 14.3, 8.2, 20.1, 12.2, 6.4, 12.9, 12.1, 6.3]
PCONSFOLD_TM = [0.63, 0.75, 0.60, 0.48, 0.54, 0.53, 0.44, 0.28, 0.56, 0.52, 0.54, 0.39, 0.29, 0.74, 0.66, 0.55, 0.47, 0.46, 0.58, 0.72, 0.61, 0.51, 0.66, 0.57, 0.51, 0.52, 0.66, 0.70, 0.40, 0.64, 0.28, 0.66, 0.55, 0.39, 0.50, 0.66, 0.64, 0.38, 0.63, 0.50, 0.36, 0.35, 0.44, 0.70, 0.67, 0.53, 0.63, 0.51, 0.55, 0.51, 0.55, 0.47, 0.76, 0.52, 0.46, 0.20, 0.48, 0.71, 0.76, 0.51, 0.64, 0.47, 0.37, 0.64, 0.41, 0.46, 0.42, 0.56, 0.52, 0.59, 0.39, 0.63, 0.71, 0.63, 0.53, 0.54, 0.83, 0.38, 0.65, 0.62, 0.74, 0.51, 0.59, 0.60, 0.54, 0.50, 0.62, 0.60, 0.66, 0.56, 0.55, 0.28, 0.38, 0.24, 0.68, 0.79, 0.40, 0.54, 0.62, 0.50, 0.42, 0.60, 0.50, 0.48, 0.58, 0.46, 0.58, 0.49, 0.51, 0.64, 0.59, 0.69, 0.62, 0.72, 0.33, 0.46, 0.80, 0.50, 0.58, 0.60, 0.55, 0.39, 0.54, 0.73, 0.60, 0.82, 0.63, 0.79, 0.35, 0.58, 0.53, 0.53, 0.74, 0.59, 0.35, 0.41, 0.66, 0.71, 0.58, 0.27, 0.38, 0.52, 0.23, 0.69, 0.42, 0.77, 0.53, 0.65, 0.42, 0.54]
PCONSFOLD_RMSD = [4.9, 3.2, 3.9, 4.3, 4.3, 6.4, 10.7, 16.4, 5.8, 4.9, 4.9, 13.4, 16.8, 2.7, 2.0, 9.9, 5.8, 10.8, 3.0, 3.5, 5.5, 8.8, 4.8, 3.2, 4.5, 9.1, 3.7, 4.0, 13.3, 4.5, 18.0, 4.0, 6.0, 10.6, 4.8, 3.7, 5.1, 11.5, 5.3, 9.1, 18.6, 8.5, 13.4, 3.4, 4.6, 10.8, 8.6, 12.6, 4.2, 7.2, 9.7, 9.8, 3.7, 4.0, 6.9, 19.2, 12.8, 4.6, 2.5, 6.7, 6.2, 8.5, 17.5, 4.2, 12.0, 10.6, 15.1, 7.3, 8.1, 7.4, 8.3, 4.1, 2.5, 5.3, 9.0, 11.6, 2.2, 12.5, 6.6, 5.7, 3.7, 8.4, 5.2, 3.6, 4.4, 9.2, 5.1, 4.9, 4.0, 7.9, 5.8, 15.9, 13.9, 14.1, 3.9, 2.0, 7.8, 7.2, 4.5, 7.2, 7.5, 2.7, 5.5, 7.9, 4.3, 15.6, 3.9, 8.0, 14.4, 6.4, 6.0, 2.9, 6.6, 4.2, 9.8, 9.9, 2.1, 7.6, 4.0, 7.6, 6.5, 8.0, 6.9, 2.2, 6.6, 2.1, 16.6, 3.2, 6.4, 5.7, 4.8, 7.3, 2.8, 6.5, 7.6, 6.1, 4.4, 7.2, 7.6, 18.7, 10.5, 9.6, 12.3, 5.2, 10.8, 3.7, 7.6, 5.2, 13.1, 6.6]

#           0      1      2      3      4      5      6      7      8      9      10     11     12     13     14     15     16     17     18     19     20     21     22     23     24     25     26     27     28     29     30     31     32     33     34     35     36     37     38     39     40     41     42     43     44     45     46     47     48     49     50     51     52     53     54     55     56     57     58     59     60     61     62     63     64     65     66     67     68     69     70     71     72     73     74     75     76     77     78     79     80     81     82     83     84     85     86      87     88     89     90     91     92     93     94     95     96     97     98     99     100    101    102    103    104    105    106    107    108    109    110    111    112    113    114    115    116    117    118    119    120    121    122    123
GDE_TM =   [0.43,  0.26,  0.35,  0.27,  0.32,  0.31,  0.30,  0.27,  0.40,  0.23,  0.28,  0.30,  0.32,  0.34,  0.27,  0.37,  0.27,  0.33,  0.36,  0.39,  0.50,  0.36,  0.33,  0.31,  0.27,  0.39,  0.30,  0.40,  0.29,  0.25,  0.23,  0.27,  0.22,  0.30,  0.25,  0.33,  0.35,  0.24,  0.41,  0.36,  0.26,  0.29,  0.31,  0.32,  0.35,  0.32,  0.33,  0.32,  0.26,  0.31,  0.37,  0.29,  0.44,  0.35,  0.32,  0.28,  0.47,  0.44,  0.34,  0.33,  0.55,  0.34,  0.26,  0.28,  0.27,  0.29,  0.35,  0.26,  0.23,  0.41,  0.27,  0.34,  0.27,  0.36,  0.34,  0.24,  0.58,  0.26,  0.41,  0.31,  0.36,  0.40,  0.25,  0.31,  0.33,  0.38,  0.52,   0.25,  0.26,  0.38,  0.34,  0.26,  0.25,  0.25,  0.38,  0.23,  0.31,  0.33,  0.31,  0.27,  0.28,  0.24,  0.29,  0.28,  0.33,  0.42,  0.30,  0.35,  0.33,  0.36,  0.40,  0.35,  0.32,  0.32,  0.31,  0.27,  0.44,  0.30,  0.26,  0.42,  0.40,  0.23,  0.31,  0.46, 0.23, 0.29, 0.42, 0.29, 0.23, 0.33, 0.32, 0.23, 0.36, 0.35, 0.27, 0.24, 0.33, 0.33, 0.28, 0.23, 0.34, 0.29, 0.24, 0.30, 0.36, 0.32, 0.32, 0.38, 0.23, 0.39]
GDE_RMSD = [6.78, 10.68,  6.93,  6.42,  7.49,  8.81, 12.14, 12.28,  9.28,  9.22,  9.12, 10.42, 10.62,  8.43,  5.95, 11.51, 11.08,  8.86,  5.72,  5.45,  7.58,  9.61, 11.74,  6.30,  8.44,  8.44,  9.42,  8.62, 10.66, 10.59, 13.91,  9.15, 13.82,  9.61,  8.90,  7.72,  9.69, 11.42,  9.15, 10.53, 13.69,  8.54, 10.61,  8.47,  7.39, 11.85, 11.88,  13.05, 9.50,  9.55,  8.80, 12.38,  6.23,  5.84, 10.09, 12.99,  7.50,  8.83,  8.34,  6.33,  6.79,  9.91, 12.69, 10.87, 11.99,  9.83, 12.59, 11.88, 14.30,  7.68,  8.71,  9.01,  9.11,  9.06, 11.86, 11.20,  4.57, 12.67,  9.61, 11.92, 11.87,  8.65,  8.89,  6.42,  8.47,  9.99,  6.27,  11.91, 12.23, 11.56, 10.58, 12.82, 10.61, 12.47,  8.51,  8.56,  5.88, 10.64, 11.06, 11.32,  9.41,  7.45,  7.71, 11.26, 10.05,  8.50,  8.29,  7.06, 14.48, 11.72,  7.33,  6.53, 11.65, 11.51, 11.39, 12.09,  5.92,  9.08,  9.88,  8.82,  8.82,  9.25,  7.39,  5.19, 10.12, 9.64, 12.18, 10.29, 8.34, 10.01, 7.40, 11.77, 8.65, 10.79, 10.20, 10.33, 11.53, 11.95, 12.79, 14.72, 9.98, 9.13, 10.30, 9.37, 9.55, 11.63, 12.12, 9.54, 13.62, 10.35]

import numpy as np
from bokeh.io import export_png, export_svgs
from bokeh.layouts import gridplot
from bokeh.models import BoxSelectTool, LassoSelectTool
from bokeh.plotting import figure, curdoc, show
from bokeh.models import ColumnDataSource, DataRange1d, Plot, LinearAxis, Grid, Legend, LegendItem


colors = ['#007379', '#009360', '#86a824', '#ffa600']


hmin = np.min(FTCOMAR_RMSD + PCONSFOLD_RMSD + GDFUZZ3D_RMSD + GDE_RMSD) * 1.1
hmax = np.max(FTCOMAR_RMSD + PCONSFOLD_RMSD + GDFUZZ3D_RMSD + GDE_RMSD) * 1.1
vmin = np.min(FTCOMAR_TM + PCONSFOLD_TM + GDFUZZ3D_TM + GDE_TM) * 1.1
vmax = np.max(FTCOMAR_TM + PCONSFOLD_TM + GDFUZZ3D_TM + GDE_TM) * 1.1

# Scatter plot
p = figure(plot_width=600, plot_height=400, min_border=10, min_border_left=50,
           toolbar_location=None, x_axis_location=None, y_axis_location=None,
           title='Folding of PSICOV150 proteins')
p.background_fill_color = '#fafafa'

p.scatter(FTCOMAR_RMSD, FTCOMAR_TM, size=5, color=colors[0], alpha=0.6, legend='FT-Comar')
p.scatter(PCONSFOLD_RMSD, PCONSFOLD_TM, size=5, color=colors[1], alpha=0.6, legend='PConsFold')
p.scatter(GDFUZZ3D_RMSD, GDFUZZ3D_TM, size=5, color=colors[2], alpha=0.6, legend='GDFuzz3D')
p.scatter(GDE_RMSD, GDE_TM, size=5, color=colors[3], alpha=0.6, legend='GDE-GaussFold')



# Horizontal histogram
LINE_ARGS = dict(color="#3A5785", line_color=None)

ph = figure(toolbar_location=None, plot_width=p.plot_width, plot_height=200, x_range=p.x_range,
            min_border=10, min_border_left=50, y_axis_location="right")
ph.xgrid.grid_line_color = None
ph.yaxis.major_label_orientation = np.pi/4
ph.background_fill_color = "#fafafa"
ph.xaxis.axis_label = 'Root Mean Square Deviation'
ph.xaxis.axis_label_text_font_size = '15pt'
ph.xaxis.axis_label_text_font_style = 'normal'

hhist, hedges = np.histogram(FTCOMAR_RMSD, bins=20)
hzeros = np.zeros(len(hedges)-1)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hhist, color=colors[0], line_color="#3A5785")
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.5, **LINE_ARGS)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.1, **LINE_ARGS)
hhist, hedges = np.histogram(PCONSFOLD_RMSD, bins=20)
hzeros = np.zeros(len(hedges)-1)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hhist, color=colors[1], line_color="#3A5785")
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.5, **LINE_ARGS)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.1, **LINE_ARGS)
hhist, hedges = np.histogram(GDFUZZ3D_RMSD, bins=20)
hzeros = np.zeros(len(hedges)-1)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hhist, color=colors[2], line_color="#3A5785")
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.5, **LINE_ARGS)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.1, **LINE_ARGS)
hhist, hedges = np.histogram(GDE_RMSD, bins=20)
hzeros = np.zeros(len(hedges)-1)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hhist, color=colors[3], line_color="#3A5785")
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.5, **LINE_ARGS)
ph.quad(bottom=0, left=hedges[:-1], right=hedges[1:], top=hzeros, alpha=0.1, **LINE_ARGS)

# Vertical histogram

pv = figure(toolbar_location=None, plot_width=200, plot_height=p.plot_height,
            y_range=p.y_range, min_border=10, y_axis_location='right')
pv.ygrid.grid_line_color = None
pv.xaxis.major_label_orientation = np.pi/4
pv.background_fill_color = '#fafafa'
pv.yaxis.axis_label = 'TM-score'
pv.yaxis.axis_label_text_font_size = '15pt'
pv.yaxis.axis_label_text_font_style = 'normal'

vhist, vedges = np.histogram(FTCOMAR_TM, bins=20)
vzeros = np.zeros(len(vedges)-1)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vhist, color=colors[0], line_color="#3A5785")
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.5, **LINE_ARGS)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.1, **LINE_ARGS)
vhist, vedges = np.histogram(PCONSFOLD_TM, bins=20)
vzeros = np.zeros(len(vedges)-1)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vhist, color=colors[1], line_color="#3A5785")
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.5, **LINE_ARGS)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.1, **LINE_ARGS)
vhist, vedges = np.histogram(GDFUZZ3D_TM, bins=20)
vzeros = np.zeros(len(vedges)-1)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vhist, color=colors[2], line_color="#3A5785")
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.5, **LINE_ARGS)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.1, **LINE_ARGS)
vhist, vedges = np.histogram(GDE_TM, bins=20)
vzeros = np.zeros(len(vedges)-1)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vhist, color=colors[3], line_color="#3A5785")
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.5, **LINE_ARGS)
pv.quad(left=0, bottom=vedges[:-1], top=vedges[1:], right=vzeros, alpha=0.1, **LINE_ARGS)

layout = gridplot([[p, pv], [ph, None]], merge_tools=False)

curdoc().add_root(layout)
curdoc().title = "Selection Histogram"


export_png(layout, filename='../imgs/gde.png')
